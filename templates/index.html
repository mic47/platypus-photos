 <!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset="UTF-8">
  <title>
Gallery
  </title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
   integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
   crossorigin=""></script>
<script src="js/main.js"></script> 
<script>
function init_fun() {
    bounds = {% if bounds %}[[{{bounds.lat[0]}}, {{bounds.lon[0]}}],[{{bounds.lat[1]}}, {{bounds.lon[1]}}]]{% else %}null{% endif %};
    location_url_json = {{location_url_json | safe}};
    dates = {{ dates | safe}};
    init_map(bounds, location_url_json);
    // TODO: dates should be dynamic
    init_dates(dates, location_url_json);
}
</script>
</head>
<body onload="init_fun()">

<div>
  <form id="input">
    <label for="ftag">Tag:</label><input type="text" id="ftag" name="tag" value="{{input.tag}}"><br>
    <label for="fcls">Text:</label><input type="text" id="fcls" name="cls" value="{{input.cls}}"><br>
    <label for="faddr">Address:</label><input type="text" id="faddr" name="addr" value="{{input.addr}}"><br>
    <label for="fdatefrom">Since</label><input type="date" id="fdatefrom" name="datefrom" value="{{input.datefrom}}" />
    <label for="fdateto">Until</label><input type="date" id="fdateto" name="dateto" value="{{input.dateto}}" /><br/>
    <label for="fdir">Directory:</label><input type="text" id="fdir" name="dir" value="{{input.dir}}"><br>
    <label for="boundary">Boundary:</label><input type="text" id="fbnd" name="bnd" value=""><br>
    <input type="submit" value="Submit">
    <input type="reset"> 
  </form>
</div>
<div>
  Found {{ total }} matches. <br>
  Top tags: 
  {% for tag in top.tag %}
    <a href="{{tag[2]}}">{{tag[0]}} ({{tag[1]}})</a>
  {% endfor %} <br/>
  Top texts: 
  {% for t in top.cls %}
    <a href="{{t[2]}}">{{t[0]}} ({{t[1]}})</a>
  {% endfor %} <br/>
  Top locs: 
  {% for t in top.addr %}
    <a href="{{t[2]}}">{{t[0]}} ({{t[1]}})</a>
  {% endfor %} <br/>
  <div id="map"></div>
  <div class="date_chart"><canvas id="DateChart"></canvas></div>
  {% if urls.prev %}<a href="{{urls.prev}}">{% endif %}Prev Page{% if urls.prev %}</a>{% endif %}
  {% if urls.next %}<a href="{{urls.next}}">{% endif %}Next Page{% if urls.next %}</a>{% endif %}
</div>
<div>

{% for image in images %}
  {% if loop.index0 == oi %}
  <div class="gallery_item overlay">
  {% else %}
  <div class="gallery_item">
  {% endif %}
    <span id="i{{loop.index0}}"></span>
    <div class="gallery_item_nav">
        {% if loop.index0 == 0 %}
        {% if urls.prev_overlay %}<a href="{{urls.prev_overlay}}">prev</a>{% else %} prev {% endif %}
        {% else %}
        <a href="#i{{ loop.index0}}" onclick="overlay_prev(this, {{ loop.index0 }})">prev</a>
        {% endif %}
        <a href="#i{{ loop.index0}}" onclick="overlay_close(this)">close</a>
        {% if loop.index == images|length %}
        {% if urls.next_overlay %}<a href="{{urls.next_overlay}}">next</a>{% else %} next {% endif %}
        {% else %}
        <a href="#i{{ loop.index0}}" onclick="overlay_next(this, {{ loop.index0 }})">next</a>
        {% endif %}
    </div>
    <div class="gallery_container" onclick="overlay(this, {{ loop.index0 }})">
    <img loading="lazy" src="/img?hsh={{image.hsh}}&size={% if loop.index0 == oi %}original{%else%}preview{%endif%}" class="gallery_image"/>
    </div>
    {{ image.classifications}} <br/>
    {% for tag in image.tags %}
    <span class="tag"><a href="{{tag[2]}}">{{tag[1]}}{{tag[0]}}</a></span>
    {% endfor %}

    {% for a in image.addrs %}
    <span class="location"><a href="{{a.url}}">{{ a.address }}</a></span>
    {% endfor %}
    {% if image.date.date %}
    <span class="date"><a href="{{image.date.url}}">{{image.date.date}}</a></span>
    {% endif %}
    {% for path in image.paths %}
    <span class="dir"><a href="{{path.dir_url}}">{{path.dir}}</a></span>
    {% endfor %}
  </div>
{% endfor %}
</div>
<br>
<div style="float: left; background: #CCCCCC; height: 10em;">
  {% if urls.prev %}<a href="{{urls.prev}}">{% endif %}Prev Page{% if urls.prev %}</a>{% endif %}
  {% if urls.next %}<a href="{{urls.next}}">{% endif %}Next Page{% if urls.next %}</a>{% endif %}
</div>
</body>
</html>
